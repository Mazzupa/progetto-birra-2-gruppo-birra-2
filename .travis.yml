env:
  - DEV_EC2_KEY: "-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAk5AZ5BOojnzQyip0WOqRHKmfGnMUyTp7h981MuXf0BTTGyz4
2KP8h0f7njWcX9Vu/v/Qa8xG3vlmi7N8GLbn9Ku3WcPHosMGFFhFEyqQigb2SnoT
NmDIiNvAl3qBtTNzYt8LFNY69PozaXfWphD4LLmNvCxG02jqEsTSnNNLybPXaRDC
bw2kkbLNlce/VOa4cxUiiVcVgPrgPauD6+DT9s4WXpVSDEE0JNmnIbLo8txO5rIf
xG5NJ0sfHPOViZL6NnvqU5eoK0mL3skWPNIZMpqaaQvxbscmRerYQEjlXQe9yS/3
uFOXLt1t4OaHg0SPZp60k/rDgEVOrGbzQgDykwIDAQABAoIBAGzS/QUjKk/K5P/z
R1K7ysDkpx2OeWnd43RUvJsIxIJkmTuVcv/yEC6Ee6A10Vkrwmv0pPSa9jlCnMmy
WHaxjWb3rIRaykPSqA0g+/Ail+3zLHfIh5q2za2AwwvzoOzNQO9NppJ7W4eHbZr+
ciKOqTfysABydtk6qkWlOd3GRkI9bEjDAVBShECS8wG789HkL1NMNQWZbQgB/k8J
4dC0W8b7u9VJQg5s9qmxrfmA2SZoPihMqh4nzmh44nq8Z6si7CW2ho/I0oBFeWm9
Js6Ap/v5aiYgIVJv3auG33a+sOxy9ArXXxghuNVTS1pp0s8LpXQG5yS6KXqpsy79
IbfFayECgYEAy3vdQgBGbhfdtSB/Mm1PeUeesRLzZlrqP1Um2JW+Mdil9f9HPxMa
l/1Lwe2NuDKa4Zh4zhBBG7LSEhwPY4828/NWK23fmGEhfR4OOCED83uhjfk0hJCb
Z7BFxm5Upxzpx86Y4vTvpzG35yAb43xN/eVfIEspPdQmKLXPGn3x7yUCgYEAuaWN
HF7+sq19crBmamGwtPMr/bsK9g2kSchgekvpZ7sBUYqa4TUHpnrGML0qnxMWq0Yo
cREHLlw3vMrUH3aQXBDAR9uS41AUDGJURz1DFdJBB7GHmKsllBu2QefUIDDiZvVh
ndgrmL8nQpYNNAIOVlpj0CObhsp3K20BJC+g6VcCgYEAkID1HuLtIU/njbJ3Qgto
rfsTkjKgEacsxS8meBbXS7TMHwdbxEo/z4H848pco1ukq+LIn6XhZtc14dB1iUFy
SAodvpe3exI3YxAODwQ7NxUsJJO+HQpIonkHBCTkDw00ZEWuQzaoXnarYAJoa8Oh
61WRmXBm6FaZhr2eRvT789UCgYBpwBhF1QcZGSKgtkNgzg0uxmaEvotb5iFztiTf
BWcLo8b4gBABwYd+GenT0a35t5HuNqTK43xHuFg3vwJeedd52kDtrfJacj85XrnL
auZQA9jvXP10xek+GRsVJ836GF6fb6APnhgXhqwCjh8vRQyNvCenZOEvQx3nKsy/
pDHxOQKBgDheCHt3yOOyL6Wcl3BF13U7yJtkLO/tdqHDuAm8Zif64TSu+nxeojuo
OAgrEwWmdkaQ7KfNMJBEsC/KM0TYFhz23UDiHGzV/sJJ1lLPVo2F7rkIEMfqL3k2
B/sR7DwNK5F6q/U1mOnd2yG9PFsFg2iTjndnLQ4AInw8dxyn+ptW
-----END RSA PRIVATE KEY-----"

script:
  - cd backend
  - mvn clean install -Pdev
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=UnimibSoftEngCourse2021_progetto-birra-2-gruppo-birra-2 -DskipTests=true
  - docker build -t gruppobirra2/brewday:latest .
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker push gruppobirra2/brewday:latest
  - echo ${DEV_EC2_KEY} > dev.pem
  - chmod 600 dev.pem
  - cat dev.pem
  - ssh -o "StrictHostKeyChecking no" -i dev.pem ${DEV_EC2_USERNAME}@${DEV_EC2_URL} touch test.txt

deploy:
  - provider: script
    skip_cleanup: true
    script:
      - ssh -o "StrictHostKeyChecking no" -i dev.pem ${DEV_EC2_USERNAME}@${DEV_EC2_URL} touch deploy.txt
    on:
      branch: develop

addons:
  sonarcloud:
    organization: "unimibsoftengcourse2021"
    token: ${SONAR_TOKEN}
  ssh_known_hosts: ${DEV_EC2_URL}

services:
  - docker

language: java
jdk:
    - openjdk11